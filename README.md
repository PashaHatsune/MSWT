**MSWT** ‚Äî Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

> ‚ö†Ô∏è | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pyenv, –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º MSWT.

–≠—Ç–∞ –≤–µ—Ä—Å–∏—è –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
[uv](https://github.com/astral-sh/uv), [aiogram](https://docs.aiogram.dev/) –∏ `.env` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

---

## üì¶ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Python

`3.10.16`

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `uv`

```bash
pip install uv
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
uv venv
```

### 3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
source .venv/bin/activate
```

---

## ‚öô –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–∞–π–ª `.env`
–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ `.env-example`.

---

## ‚ñ∂ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
uv run -m src.bot
```

---

## ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` –∏–ª–∏ `/help` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ –º–µ–Ω—é.
- `/info` ‚Äî —Å–≤–æ–¥–∫–∞ –ø–æ CPU/RAM/ROM/OS –∏ –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞.
- `/sh <–∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ –ø—É—Ç—å>` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É; –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ñ–∞–π–ª. –†–∞–±–æ—Ç–∞–µ—Ç –∏ –∫–∞–∫ reply –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π. –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî 60 —Å–µ–∫—É–Ω–¥.
- `/bots` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ `./sh-module`, –∏–º—è –∫–æ—Ç–æ—Ä—ã—Ö –æ–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `-start.sh` (–∞–≤—Ç–æ—Å—Ç–∞—Ä—Ç).
- `/startsh <file.sh>` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏–∑ `./sh-module` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ `./sh-module/logs/*.log`. –ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –ø–æ–∫–∞–∂–µ—Ç —Å–ø–∏—Å–æ–∫ `.sh`.
- `/stopsh <file.sh>` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–∫—Ä–∏–ø—Ç–∞ –∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ-—Ä–µ—Å—Ç–∞—Ä—Ç.
- `/logs <file.sh>` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –∏–ª–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–≥–æ–≤/—Å–∫—Ä–∏–ø—Ç–æ–≤.
- `/restart` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å `restart-daemon.sh` (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ systemd-—é–Ω–∏—Ç–æ–≤).
- `/stop` ‚Äî –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `sudo reboot` (**–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!**).

---

# –ó–∞–¥–∞—á–∏ (TASK's)

–í –±–æ—Ç–µ –µ—Å—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∑–∞–ø—É—Å–∫–∞ **—Ç–∞—Å–∫–æ–≤** ‚Äî —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–æ—Ç.
–ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –≤–∞–º –≤ –¢–µ–ª–µ–≥—Ä–∞–º.

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é –∑–∞–¥–∞—á—É [–ø—Ä–∏–º–µ—Ä]

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –∑–∞–¥–∞—á–µ–π –≤ –ø–∞–ø–∫–µ `src/bot/handlers/tasks`. –ù–∞–ø—Ä–∏–º–µ—Ä: `BackupBD.py`.

2. –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ —Å–æ–∑–¥–∞–π—Ç–µ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é** —Å –∏–º–µ–Ω–µ–º `start_task`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –æ–±—ä–µ–∫—Ç –±–æ—Ç–∞ `bot` —Ç–∏–ø–∞ `Bot` –∏–∑ aiogram.

```python
from aiogram import Bot
import asyncio

async def start_task(bot: Bot) -> None:
    while True:
        try:
            # –ó–¥–µ—Å—å –ª–æ–≥–∏–∫–∞ –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä –±—ç–∫–∞–ø –±–∞–∑—ã
            await run_mongodump(...)
        except Exception as e:
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            print(f"–û—à–∏–±–∫–∞ –≤ –∑–∞–¥–∞—á–µ: {e}")
        await asyncio.sleep(10000)  # –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–ø—É—Å–∫–æ–º
```

3. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥—É—Ç—Å—è –≤—Å–µ —Ç–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –∏ –±—É–¥—É—Ç –∑–∞–ø—É—â–µ–Ω—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

---

# –°–µ—Ä–≤–∏—Å—ã

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–∞–ø–∫–∞ `sh-module`.
–í —ç—Ç—É –ø–∞–ø–∫—É –Ω—É–∂–Ω–æ –ø–æ–º–µ—â–∞—Ç—å –≤–∞—à–∏ `.sh`-—Å–∫—Ä–∏–ø—Ç—ã (—é–Ω–∏—Ç—ã).

**–í–∞–∂–Ω–æ:**
–ò–º—è —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `-start.sh`, –Ω–∞–ø—Ä–∏–º–µ—Ä: `–ú–æ—ë–ù–∞–∑–≤–∞–Ω–∏–µ-start.sh`.
–ï—Å–ª–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å `-start.sh`, –±–æ—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞—à —é–Ω–∏—Ç.

–ó–∞–ø—É—Å–∫–∏ —á–µ—Ä–µ–∑ `/startsh` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `./sh-module/logs` –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –≤–æ—Ç—á–¥–æ–≥–æ–º: –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫). –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏ —Å–Ω—è—Ç—å –µ–≥–æ —Å –∞–≤—Ç–æ-—Ä–µ—Å—Ç–∞—Ä—Ç–∞ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ `/stopsh`.

---

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ —é–Ω–∏—Ç–∞ ‚Äî `hello-start.sh`:

```bash
#!/bin/bash
echo '–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!'
```

---

### –ü—Ä–∏–º–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ telegram-–±–æ—Ç–∞:
```bash
#!/bin/bash
cd /home/miku/dev/MSWT
source .venv/bin/activate
uv run bot.py
```

# üõ† –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Å systemd

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –±–æ—Ç –∑–∞–ø—É—Å–∫–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ systemd unit-—Ñ–∞–π–ª.

### –ü—Ä–∏–º–µ—Ä `mswt.service` (–≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):

```ini
[Service]
ExecStart=/–ü–£–¢–¨_–ö_MSWT/start-server.sh
RestartSec=10
Restart=always
Type=simple

[Install]
WantedBy=default.target
```

### –í–∞–∂–Ω—ã–µ —à–∞–≥–∏:

1. –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞–º:

```bash
chmod +x /–ü–£–¢–¨_–ö_MSWT/restart-daemon.sh
chmod +x /–ü–£–¢–¨_–ö_MSWT/start-server.sh
```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ unit-—Ñ–∞–π–ª –≤ systemd:

```bash
sudo cp mswt.service /home/user/.config/systemd/user/
```

3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é systemd:

```bash
sudo systemctl --user daemon-reload
```

4. –í–∫–ª—é—á–∏—Ç–µ –∏ —Å—Ä–∞–∑—É –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:

```bash
sudo systemctl --user enable mswt.service --now
```

### –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `/sh`

- –§–æ—Ä–º–∞—Ç: `/sh <–∫–æ–º–∞–Ω–¥–∞>` –∏–ª–∏ —Ä–µ–ø–ª–∞–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π.
- –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –≤—ã–≤–æ–¥ sudo, –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ stdin:

```bash
echo "my_password" | sudo -S pacman -Syu
```

- –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –ø–∏—à–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤—ã–≤–æ–¥ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º.

---
